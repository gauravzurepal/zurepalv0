/**
 * Created by root on 2/16/17.
 */
var CommentBox = React.createClass({
    loadCommentsFromServer: function() {
        $.ajax({
            url: this.props.url,
            dataType: 'json',
            cache: false,
            success: function(data) {
                this.setState({data: data});
            }.bind(this),
            error: function(xhr, status, err) {
                console.error(this.props.url, status, err.toString());
            }.bind(this)
        });
    },
    handleCommentSubmit: function(comment) {
        var comments = this.state.data;
        // Optimistically set an id on the new comment. It will be replaced by an
        // id generated by the server. In a production application you would likely
        // not use Date.now() for this and would have a more robust system in place.
        comment.id = Date.now();
        var newComments = comments.concat([comment]);
        this.setState({data: newComments});
        $.ajax({
            url: this.props.url,
            dataType: 'json',
            type: 'POST',
            data: comment,
            success: function(data) {
                this.setState({data: data});
            }.bind(this),
            error: function(xhr, status, err) {
                this.setState({data: comments});
                console.error(this.props.url, status, err.toString());
            }.bind(this)
        });
    },
    getInitialState: function() {
        return {data: [], zureChat: '', text: '', url:'/zure/start'};
    },
    componentDidMount: function() {
        //this.loadCommentsFromServer();
        //setInterval(this.loadCommentsFromServer, this.props.pollInterval);
    },
    render: function() {
        return (
            <div className="commentBox">
                <ul id="messages"></ul>
                <CommentForm onCommentSubmit={this.handleCommentSubmit} />
            </div>
        );
    }
});


var CommentForm = React.createClass({
    _handleKeyPress: function(e) {
        this.setState({zureChat: e.target.value});
        if (e.key === 'Enter') {

            var comment = e.target.value;

            console.log("Text "+comment);
            if(comment == 'hi'){
                io.socket.get('/zure/hello', function gotResponse(data, jwRes) {
                    console.log('Server responded with status code ' + jwRes.statusCode + ' and data: ', data);
                });
            }else{
                $.post('/zure/start', {comment:e.target.value}, function(response){
                    console.log("hello %o", (response));
                });
            }

        }
    },
    render: function() {
        return (
                <input
                    id="m"
                    type="text"
                    placeholder="What is your name pal?"
                    onKeyPress={this._handleKeyPress}
                />
        );
    }
});

ReactDOM.render(
    <CommentBox url="/api/comments" pollInterval={2000} />,
    document.getElementById('content')
);